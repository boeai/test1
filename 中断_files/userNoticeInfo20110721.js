/*
 * 用户各种通知信息页面显示
 * Copyright 2010, Hudong.com
 * author: zhangjuanli
 * editor:hcp000 
 * $Date: 2011-07-04 $
 * $Last: 2011-09-07 $
 */
var commonUtils={jQuerySupport:(typeof jQuery=="undefined")?false:true,getCookie:function(c){var d=document.cookie.indexOf(c+"=");var a=d+c.length+1;if((!d)&&(c!=document.cookie.substring(0,c.length))){return null}if(d==-1){return null}var b=document.cookie.indexOf(";",a);if(b==-1){b=document.cookie.length}return unescape(document.cookie.substring(a,b))},isHDLogin:function(){return(commonUtils.getCookie("hduser")!=null)},loadDynamicJs:function(c,a){var b=document.createElement("script");b.src=c+"&t="+Math.random();b.type="text/javascript";b.onreadystatechange=function(){if(b.readyState=="complete"||b.readyState=="loaded"){setTimeout(function(){a()},1000)}},b.onload=function(){setTimeout(function(){a()},1000)};document.getElementsByTagName("head").item(0).appendChild(b)}};var userNoticeDataInfo={keys:["newFansCount","unReadNoticeCount","newFeedMeCount","unReadPrivateMsgCount","unReadNewSystemCount","newRecommendMissionCount","unReadBaikeNoticeCount"],noticeUrl:{newFansCount:"<li id='sns_new_fans_count' key='newFansCount'><strong>$</strong>个新粉丝，<a href='http://i.hudong.com/fansList.do'>打个招呼去</a>。</li>",unReadNoticeCount:"<li id='sns_reply_count' key='unReadNoticeCount'><strong>$</strong>条新回复，<a href='http://i.hudong.com/unReadNotice.do'>查看最新回复</a>。</li>",newFeedMeCount:"<li id='sns_new_feed_me_count' key='newFeedMeCount'><strong>$</strong>条新鲜事提到我，<a href='http://i.hudong.com/home.do?type=2'>查看@我的</a>。</li>",unReadPrivateMsgCount:"<li id='sns_private_msg_count' key='unReadPrivateMsgCount'><strong>$</strong>封新的站内信，<a href='http://i.hudong.com/myMsgs.do'>马上查看</a>。</li>",unReadNewSystemCount:"<li id='sns_system_msg_count' key='unReadNewSystemCount'><strong>$</strong>个系统通知，<a href='http://i.hudong.com/myMsgs.do?action=inbox&msg_type=1'>马上查看</a>。</li>",newRecommendMissionCount:"<li id='sns_new_mission_count' key='newRecommendMissionCount'>您有新的推荐任务，<a href='http://i.hudong.com/myMissions.do?showType=2'>马上查看</a>。</li>",unReadBaikeNoticeCount:"<li id='sns_baike_notice_count' key='unReadBaikeNoticeCount'><strong>$</strong>条小百科回复，<a href='http://i.hudong.com/myMsgs.do?action=baikeNotice'>查看最新回复</a>。</li>"},defaults:{divId:"sns-remind",location:$(document.body),hrefType:"_blank"},setNoticeKeys:function(c){var a=this;var b;if(typeof c=="undefined"||c==null){c=a.keys;b=c}else{b=c}a.keys=b;return a.keys},setNoticeUrl:function(a){var b=this;var c;if(typeof a=="undefined"||a==null){a=b.noticeUrl;c=a}else{c=a}b.noticeUrl=c;return b.noticeUrl},initHD:function(b){var a=this;b=a.getInitArgs(b);if(commonUtils.isHDLogin()){a.getUserNoticeHTMLforHD(b)}},getDisplayData:function(d){var a=this;if(d!=null){for(var c in a.keys){var b=a.keys[c];if(d.hasOwnProperty(b)){if(d[b]==0){delete d[b]}}}}return d},getUnreadDataTotalNum:function(d){var a=this;var e=0;if(d!=null){for(var c in a.keys){var b=a.keys[c];if(d.hasOwnProperty(b)){e+=d[b]}}}return e},getDataHtml:function(d){var b=this;var e="";for(var c in b.keys){var a=b.keys[c];if(d.hasOwnProperty(a)){if(b.noticeUrl.hasOwnProperty(a)){e+=b.noticeUrl[a].replace("$",d[a])}}}return e},getInitArgs:function(b){var a=this;if((typeof(b)=="undefined")||(b==null)){b=a.defaults}else{function c(h,e){var g;for(var f in h){g=typeof e[f];if(g=="undefined"){e[f]=h[f]}else{if(g=="object"){var d=typeof e[f].html;if(d=="undefined"){c(h[f],e[f])}}}}}c(a.defaults,b)}return b},getUserNoticeHTML:function(b){var a=this;b=a.getInitArgs(b);a.getDataInfo(function(c){if(typeof(c)!="undefined"&&c!=null){displayData=a.getDisplayData(c);if(commonUtils.jQuerySupport){funsHasJquery.getDisplayHtmlHasJquery(displayData,b)}else{funsNoJquery.getDisplayHtmlNoJquery(displayData);return}}})},getUserNoticeHTMLforHD:function(b){var a=this;a.getDataInfo(function(c){if(typeof(c)!="undefined"&&c!=null){displayData=a.getDisplayData(c);if(commonUtils.jQuerySupport){funsHasJquery.getDisplayHtmlHasJquery(displayData,b)}else{funsNoJquery.getDisplayHtmlNoJquery(displayData);return}}})},getDataInfo:function(b){var a="http://i.hudong.com/userNoticeInfo.do?action=getNewCountInfo&callback=dataInfo";commonUtils.loadDynamicJs(a,function(){if(typeof(dataInfo)!="undefined"&&dataInfo!=null){b(dataInfo)}})}};var funsHasJquery={getDisplayHtmlHasJquery:function(d,c){var b=this;var g="";var a="";if(d!=null){g=userNoticeDataInfo.getDataHtml(d)}var e=userNoticeDataInfo.getUnreadDataTotalNum(d);if(e>0){if(g!=null){var a="<div style='display:none' id='"+c.divId+"' ><a href='javascript:void(0);' class='roomguanbi' target='_self'></a><ul>"+g+"</ul></div>";b.cleanPanel(c);var f=c.location;f.append(a);$("#"+c.divId+"").slideDown("normal");$("#"+c.divId+" .roomguanbi").bind("click",function(){funsHasJquery.cleanPanel(c)});$("div[id='"+c.divId+"']>ul a").attr("target",c.hrefType).bind("click",function(){if($("div[id='"+c.divId+"'] ul a").length<=1){b.cleanPanel(c)}else{$(this).parent().remove()}})}}else{b.cleanPanel(c)}},cleanPanel:function(a){if($("#"+a.divId+"").length>0){$("#"+a.divId+"").remove()}}};var funsNoJquery={getDisplayHtmlNoJquery:function(a){return}};